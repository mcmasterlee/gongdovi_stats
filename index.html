<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gongdobi AI Analytics</title>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --bg-body: #F8FAFC;
            --bg-card: #FFFFFF;
            --primary: #1E293B;
            --secondary: #64748B;
            --gold: #D97706;
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --border: 1px solid #E2E8F0;
            
            /* Target Colors */
            --female: #EC4899; /* Pink */
            --male: #3B82F6;   /* Blue */
            --age30: #F59E0B;  /* Amber */
            --age40: #10B981;  /* Emerald */
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-body);
            color: var(--primary);
            margin: 0;
            padding: 30px;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .container { max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; background: transparent; padding: 0;
        }

        .brand-box {
            background-color: #000000; padding: 15px 30px; border-radius: 12px;
            display: flex; align-items: center; gap: 12px; box-shadow: var(--shadow);
        }
        .brand-box h1 { margin: 0; font-size: 20px; font-weight: 700; color: #FFFFFF; letter-spacing: -0.5px; }
        .ai-badge { background: #333; color: #00E096; font-size: 12px; padding: 4px 8px; border-radius: 4px; font-weight: 800; }

        .date-control {
            display: flex; align-items: center; gap: 15px;
            background: #FFFFFF; padding: 10px 25px; border-radius: 30px;
            border: var(--border); box-shadow: var(--shadow);
        }
        .nav-btn { background: none; border: none; cursor: pointer; color: var(--secondary); font-size: 16px; transition: 0.2s; }
        .nav-btn:hover { color: var(--primary); transform: scale(1.1); }
        .current-date { font-weight: 800; font-size: 18px; min-width: 80px; text-align: center; color: var(--primary); }

        .grid-container {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px;
            width: 100%; box-sizing: border-box;
        }
        .span-1 { grid-column: span 1; }
        .span-3 { grid-column: span 3; }

        .card {
            background: var(--bg-card); border-radius: var(--radius); padding: 20px;
            box-shadow: var(--shadow); border: var(--border);
            display: flex; flex-direction: column; position: relative;
            width: 100%; box-sizing: border-box; overflow: hidden;
        }

        .card-title { font-size: 14px; font-weight: 600; color: var(--secondary); margin-bottom: 8px; display: flex; align-items: center; gap: 6px;}
        .kpi-value { font-size: 26px; font-weight: 800; color: var(--primary); letter-spacing: -1px; margin-bottom: 4px; }
        .kpi-diff { font-size: 13px; font-weight: 600; padding: 3px 8px; border-radius: 4px; display: inline-block; }
        .up { background: #ECFDF5; color: #047857; }
        .down { background: #FEF2F2; color: #DC2626; }

        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .chart-title { font-size: 16px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .view-switch {
            background: #F1F5F9; padding: 4px; border-radius: 8px; display: flex; gap: 4px;
        }
        .switch-btn {
            border: none; background: transparent; padding: 6px 12px; border-radius: 6px;
            font-size: 12px; font-weight: 600; color: var(--secondary); cursor: pointer; transition: 0.2s;
        }
        .switch-btn.active { background: #FFFFFF; color: var(--primary); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

        .fixed-height-box { height: 320px; width: 100%; position: relative; overflow: hidden; }
        
        /* Views */
        .chart-view { width: 100%; height: 100%; display: block; position: relative; }
        .table-view {
            width: 100%; height: 100%; overflow-y: auto; overflow-x: hidden;
            display: none; border: 1px solid #F1F5F9; border-radius: 8px; box-sizing: border-box;
        }
        .table-view.active { display: block; }

        /* --- CSS Infographic --- */
        .target-infographic {
            display: flex; flex-direction: column; justify-content: center; height: 100%; padding: 10px 0;
        }
        
        .info-group { margin-bottom: 25px; }
        .info-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: 600; }
        
        /* Gender Bar */
        .gender-bar-bg { width: 100%; height: 24px; background: #F1F5F9; border-radius: 12px; overflow: hidden; display: flex; }
        .gender-f { height: 100%; background: var(--female); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; transition: width 0.5s;}
        .gender-m { height: 100%; background: var(--male); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; transition: width 0.5s;}

        /* Age Bars */
        .age-item { margin-bottom: 12px; }
        .age-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; color: var(--secondary); }
        .progress-track { width: 100%; height: 10px; background: #F1F5F9; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 5px; transition: width 0.5s; }
        .fill-30 { background: var(--age30); }
        .fill-40 { background: var(--age40); }

        /* --- Tables --- */
        .analysis-table, .event-table { 
            width: 100% !important; table-layout: fixed !important; 
            border-collapse: collapse; font-size: 13px; 
        }
        th { 
            position: sticky; top: 0; background: #F8FAFC; padding: 10px 4px; 
            text-align: center; border-bottom: 1px solid #E2E8F0; color: var(--secondary); z-index: 5;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        td { 
            padding: 10px 4px; text-align: center; border-bottom: 1px solid #F1F5F9; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        tr.current-month-row { background-color: #ECFDF5; font-weight: 700; color: #047857; } 

        .bottom-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; width: 100%; box-sizing: border-box;}
        .bottom-card { height: 320px; width: 100%; box-sizing: border-box; overflow: hidden; display: flex; flex-direction: column; }
        .table-wrap { overflow-y: auto; overflow-x: hidden; flex-grow: 1; padding-right: 2px; width: 100%; }
        .table-wrap::-webkit-scrollbar { width: 5px; }
        .table-wrap::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 10px; }

        .rank-circle { width: 18px; height: 18px; background: var(--primary); color: #fff; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; margin-right: 8px; flex-shrink: 0; }

        .ai-box { background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%); color: #fff; border: 1px solid #334155; }
        .ai-title { color: #fff; border-bottom: 1px solid #334155; padding-bottom: 12px; margin-bottom: 12px; font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px;}
        .ai-scroll { overflow-y: auto; flex-grow: 1; padding-right: 5px; overflow-x: hidden;}
        .ai-scroll::-webkit-scrollbar { width: 5px; }
        .ai-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .ai-text { font-size: 13px; line-height: 1.6; color: #E2E8F0; margin-bottom: 15px; }
        .ai-highlight { color: #38BDF8; font-weight: 700; }
        .ai-sub-title { color: #94A3B8; font-size: 12px; margin-bottom: 8px; font-weight: 700; text-transform:uppercase; border-left: 3px solid #38BDF8; padding-left: 8px; }
        
        .strategy-box { 
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; 
            margin-bottom: 6px; border: 1px solid rgba(255,255,255,0.1); 
            display: flex; align-items: flex-start; gap: 10px;
        }
        .strategy-rank { color: var(--gold); font-weight: 800; font-size: 14px; margin-top: 2px;}
        .strategy-content strong { color: #fff; font-size: 13px; display: block; margin-bottom: 2px;}
        .strategy-content span { font-size: 11px; color: #94A3B8; }

        @media (max-width: 1024px) {
            .grid-container, .bottom-row { grid-template-columns: 1fr; }
            .span-1, .span-3 { grid-column: span 1; }
            header { flex-direction: column; align-items: flex-start; gap: 15px; }
            .brand-box { width: 100%; justify-content: center; }
            .date-control { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand-box">
            <h1>ê³µë„ë¹„ ìš´ì˜ í˜„í™©</h1>
            <span class="ai-badge">AI Report</span>
        </div>
        <div class="date-control">
            <button class="nav-btn" onclick="changeMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="currentDate" class="current-date">2025.12</span>
            <button class="nav-btn" onclick="changeMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
    </header>

    <!-- KPI -->
    <div class="grid-container">
        <div class="card span-1">
            <div class="card-title">ì „ì²´ íšŒì› ìˆ˜</div>
            <div class="kpi-value" id="kpi-total">-</div>
            <div id="diff-total">-</div>
        </div>
        <div class="card span-1">
            <div class="card-title">ì›”ê°„ ì´ ë°©ë¬¸ íšŸìˆ˜ (Total)</div>
            <div class="kpi-value" id="kpi-visit">-</div>
            <div id="diff-visit">-</div>
        </div>
        <div class="card span-1">
            <div class="card-title">ì‹ ê·œ ê°€ì…ì</div>
            <div class="kpi-value" id="kpi-new">-</div>
            <div id="diff-new">-</div>
        </div>
        <div class="card span-1" style="border: 1px solid var(--gold); background: #FFFBEB;">
            <div class="card-title" style="color:#92400E;"><i class="fa-solid fa-crown"></i> í˜„ì¬ ì¹´í˜ ë“±ê¸‰</div>
            <div class="kpi-value" id="kpi-rank" style="color:#B45309;">-</div>
            <div style="font-size:13px; color:#92400E; font-weight:600;">í™œë™ì ìˆ˜ <span id="kpi-score">0</span>ì </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="grid-container">
        <!-- Main Chart -->
        <div class="card span-3">
            <div class="chart-header">
                <div class="chart-title"><i class="fa-solid fa-chart-line"></i> ì›”ê°„ ìˆœë°©ë¬¸ì ì¶”ì´ (Unique)</div>
                <div class="view-switch">
                    <button class="switch-btn active" id="btn-main-chart" onclick="toggleView('main', 'chart')">ì°¨íŠ¸</button>
                    <button class="switch-btn" id="btn-main-table" onclick="toggleView('main', 'table')">ì›”ê°„ ë¶„ì„í‘œ</button>
                </div>
            </div>
            
            <div class="fixed-height-box">
                <div id="mainChartWrapper" class="chart-view" style="display: block;">
                    <canvas id="mainChart"></canvas>
                </div>
                <div id="mainTableWrapper" class="table-view">
                    <table class="analysis-table">
                        <colgroup><col width="20%"><col width="20%"><col width="20%"><col width="20%"><col width="20%"></colgroup>
                        <thead><tr><th>ì›”</th><th>24ë…„ ìˆœë°©ë¬¸</th><th>25ë…„ ìˆœë°©ë¬¸</th><th>ì¦ê°</th><th>ì¦ê°ë¥ </th></tr></thead>
                        <tbody id="mainTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Target Analysis (CSS Infographic) -->
        <div class="card span-1">
            <div class="chart-header">
                <div class="chart-title"><i class="fa-solid fa-users"></i> íƒ€ê²Ÿ ë¶„ì„</div>
                <div class="view-switch">
                    <!-- Button Text Changed Here -->
                    <button class="switch-btn active" id="btn-target-chart" onclick="toggleView('target', 'chart')">ì°¨íŠ¸</button>
                    <button class="switch-btn" id="btn-target-table" onclick="toggleView('target', 'table')">í‘œ</button>
                </div>
            </div>

            <div class="fixed-height-box">
                <!-- CSS Infographic View -->
                <div id="targetChartWrapper" class="chart-view">
                    <div class="target-infographic">
                        <!-- Gender -->
                        <div class="info-group">
                            <div class="info-header">
                                <span style="color:var(--female)">ì—¬ì„± <span id="val-female">0%</span></span>
                                <span style="color:var(--male)">ë‚¨ì„± <span id="val-male">0%</span></span>
                            </div>
                            <div class="gender-bar-bg">
                                <div id="bar-female" class="gender-f"></div>
                                <div id="bar-male" class="gender-m"></div>
                            </div>
                        </div>
                        <!-- Age -->
                        <div class="info-group">
                            <div class="age-item">
                                <div class="age-label"><span>30ëŒ€ ì—¬ì„±</span><strong id="val-age30" style="color:var(--age30)">0%</strong></div>
                                <div class="progress-track"><div id="bar-age30" class="progress-fill fill-30" style="width:0%"></div></div>
                            </div>
                            <div class="age-item">
                                <div class="age-label"><span>40ëŒ€ ì—¬ì„±</span><strong id="val-age40" style="color:var(--age40)">0%</strong></div>
                                <div class="progress-track"><div id="bar-age40" class="progress-fill fill-40" style="width:0%"></div></div>
                            </div>
                        </div>
                        <div style="text-align:center; font-size:11px; color:var(--secondary); background:#F1F5F9; padding:8px; border-radius:6px;">
                            <strong>Main Target Persona</strong><br>
                            40ëŒ€ í•™ë¶€ëª¨ ì—¬ì„±ì´ í•µì‹¬ ì½”ì–´ì¸µì…ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                
                <!-- Table View -->
                <div id="targetTableWrapper" class="table-view">
                    <table class="analysis-table">
                         <colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup>
                        <thead><tr><th>ì›”</th><th>ì—¬ì„±</th><th>30ëŒ€</th><th>40ëŒ€</th></tr></thead>
                        <tbody id="targetTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Row -->
    <div class="bottom-row">
        <div class="card bottom-card">
            <div class="chart-header">
                <div class="chart-title"><i class="fa-solid fa-list-check"></i> ì§„í–‰ ì´ë²¤íŠ¸ ì„±ê³¼</div>
            </div>
            <div class="table-wrap">
                <table class="event-table">
                    <colgroup><col width="20%"><col width="50%"><col width="15%"><col width="15%"></colgroup>
                    <thead><tr><th>ë‚ ì§œ</th><th>ì´ë²¤íŠ¸ëª…</th><th>ì¡°íšŒ</th><th>ë°˜ì‘</th></tr></thead>
                    <tbody id="eventTable"></tbody>
                </table>
            </div>
        </div>

        <div class="card bottom-card ai-box">
            <div class="ai-title"><i class="fa-solid fa-robot"></i> AI ìš´ì˜ ì¸ì‚¬ì´íŠ¸</div>
            <div class="ai-scroll">
                <div class="ai-sub-title">ğŸ“Š Monthly Deep Dive</div>
                <div id="ai-analysis" class="ai-text"></div>
                <div style="margin-top: 20px;">
                    <div class="ai-sub-title">ğŸ”¥ ìµì›”(<span id="nextMonthLabel"></span>) í‚¬ëŸ¬ ì½˜í…ì¸  Top 3</div>
                    <div id="ai-strategy"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Data Definition ---
    const statsDB = {
        '2024': {
            '01': { total:9068, new:406, unique:10265, pv:70782, visit:36873, f:89.7, age30:4.1, age40:33.7 },
            '02': { total:9600, new:532, unique:9318, pv:76748, visit:33126, f:90.5, age30:3.7, age40:35.0 },
            '03': { total:10092, new:492, unique:9379, pv:73546, visit:33905, f:88.4, age30:4.9, age40:29.7 },
            '04': { total:10525, new:433, unique:10640, pv:80684, visit:37861, f:86.9, age30:3.8, age40:31.5 },
            '05': { total:10813, new:288, unique:14050, pv:70305, visit:40666, f:87.1, age30:3.8, age40:28.4 },
            '06': { total:11097, new:278, unique:16326, pv:70215, visit:40894, f:86.7, age30:3.7, age40:28.3 },
            '07': { total:11563, new:466, unique:12502, pv:96123, visit:45315, f:87.8, age30:3.5, age40:30.0 },
            '08': { total:11864, new:301, unique:11531, pv:74530, visit:37742, f:87.3, age30:3.5, age40:28.7 },
            '09': { total:12088, new:224, unique:11087, pv:68751, visit:36572, f:88.3, age30:3.5, age40:28.3 },
            '10': { total:12537, new:449, unique:14048, pv:74522, visit:40359, f:87.9, age30:3.4, age40:27.6 },
            '11': { total:12971, new:434, unique:18648, pv:97591, visit:49004, f:88.0, age30:3.3, age40:27.8 },
            '12': { total:13567, new:596, unique:22882, pv:145671, visit:65466, f:89.5, age30:4.2, age40:26.3 }
        },
        '2025': {
            '01': { total:14121, new:554, unique:24126, pv:107443, visit:56610, f:87.6, age30:4.1, age40:24.7 },
            '02': { total:14676, new:555, unique:21258, pv:97898, visit:50112, f:87.6, age30:3.7, age40:25.0 },
            '03': { total:15285, new:609, unique:26210, pv:96759, visit:56907, f:87.6, age30:3.3, age40:24.1 },
            '04': { total:15941, new:656, unique:25017, pv:94614, visit:55494, f:87.5, age30:2.8, age40:22.1 },
            '05': { total:16364, new:423, unique:19415, pv:78057, visit:45501, f:89.0, age30:2.8, age40:23.1 },
            '06': { total:17045, new:681, unique:26243, pv:104905, visit:55586, f:87.8, age30:3.5, age40:22.8 },
            '07': { total:17685, new:640, unique:30214, pv:115879, visit:63665, f:86.9, age30:3.3, age40:22.9 },
            '08': { total:18323, new:638, unique:27107, pv:89203, visit:52592, f:86.1, age30:3.3, age40:22.1 },
            '09': { total:19274, new:951, unique:29749, pv:90621, visit:54603, f:86.7, age30:4.0, age40:20.8 },
            '10': { total:19897, new:623, unique:35259, pv:85819, visit:57434, f:85.3, age30:3.5, age40:19.5 },
            '11': { total:20765, new:868, unique:32957, pv:103393, visit:62379, f:86.6, age30:3.5, age40:20.2 },
            '12': { total:22244, new:1479, unique:33623, pv:113022, visit:66721, f:83.3, age30:3.6, age40:18.8 }
        }
    };
    
    const MONTH_KEYS = ['01','02','03','04','05','06','07','08','09','10','11','12'];
    const rankDB = { '01':'ì—´ë§¤2','02':'ì—´ë§¤1','03':'ì—´ë§¤1','04':'ì—´ë§¤1','05':'ì—´ë§¤3','06':'ì—´ë§¤5','07':'ì—´ë§¤5','08':'ì—´ë§¤5','09':'ì—´ë§¤5','10':'ì—´ë§¤5','11':'ì—´ë§¤5','12':'ì—´ë§¤5' };
    const scoreDB = { '01':'33,639','02':'30,352','03':'30,412','04':'29,471','05':'67,054','06':'98,294','07':'97,307','08':'87,130','09':'95,550','10':'92,313','11':'95,466','12':'105,705' };
    const eventDB = {
        '2025-01': [{d:'1/07', t:'22ë…„ë„ ì´ˆë“± 1í•™ê¸° êµì‚¬ìš© êµì¬ ì¦ì •', v:664, c:35, l:30}, {d:'1/10', t:'ê³ ë“± êµì‚¬ìš© êµì¬ ì¦ì •', v:1453, c:122, l:35}],
        '2025-12': [{d:'12/01', t:'ê°œë…ë£¨íŠ¸&ìœ í˜•ë§Œë ™ ê³ ë“± ìˆ˜í•™ ì²´í—˜ë‹¨', v:1101, c:51, l:34}, {d:'12/17', t:'2026 ì„ ìƒë‹˜ ìˆ˜ì—… ì§€ì›! ìˆ˜í•™êµêµ¬ ë“œë¦¼', v:1788, c:162, l:63}, {d:'12/18', t:'25ë…„ íš¨ì êµì¬ ì†Œê°œ ì´ë²¤íŠ¸', v:1694, c:104, l:66}, {d:'12/19', t:'26ë…„ ì´ˆë“±/ì¤‘í•™ 1í•™ê¸° êµì‚¬ìš© êµì¬ ì¦ì • 2ì°¨', v:2286, c:212, l:73}],
        '2025-02': [{d:'2/10', t:'2025 ìƒˆí•™ê¸° ë§ì´ ê°„ì‹ë°•ìŠ¤', v:1919, c:242, l:79}, {d:'2/25', t:'ê·€ì—¼ë½€ì§ ì™„ê³µì´ ìŠ¤í‹°ì»¤ ì¸ì¦', v:1048, c:155, l:42}],
        '2025-03': [{d:'3/14', t:'22íšŒ í…Œì†œ ìˆ˜í•™í•™ë ¥í‰ê°€', v:802, c:187, l:33}, {d:'3/26', t:'ì¤‘ê³ ë“± ì™„ì ê¸°ì¶œí”½ ì²´í—˜ë‹¨', v:779, c:62, l:26}]
    };

    function getEvents(year, month) { return eventDB[`2025-${month}`] || []; }

    Chart.defaults.font.family = "'Pretendard', sans-serif";
    Chart.defaults.color = '#64748B';

    let mainChart;
    let blinkInterval;
    let currentDate = new Date(2025, 11); 

    function init() { 
        renderReport(); 
        renderMainTable();
        renderTargetTable();
    }
    window.onload = init;

    function changeMonth(delta) {
        const next = new Date(currentDate);
        next.setMonth(next.getMonth() + delta);
        if(next.getFullYear() !== 2025) { alert("2025ë…„ ë°ì´í„°ë§Œ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
        currentDate = next;
        renderReport();
        renderMainTable();
        renderTargetTable();
        scrollToActiveRow('mainTableWrapper');
        scrollToActiveRow('targetTableWrapper');
    }

    function toggleView(section, mode) {
        const wrapperChart = document.getElementById(section + 'ChartWrapper');
        const wrapperTable = document.getElementById(section + 'TableWrapper');
        const btnChart = document.getElementById('btn-' + section + '-chart');
        const btnTable = document.getElementById('btn-' + section + '-table');

        if(mode === 'chart') {
            wrapperChart.style.display = (section === 'target') ? 'block' : 'block';
            wrapperTable.classList.remove('active');
            btnChart.classList.add('active');
            btnTable.classList.remove('active');
        } else {
            wrapperChart.style.display = 'none';
            wrapperTable.classList.add('active');
            btnChart.classList.remove('active');
            btnTable.classList.add('active');
            scrollToActiveRow(section + 'TableWrapper');
        }
    }

    function scrollToActiveRow(wrapperId) {
        setTimeout(() => {
            const container = document.getElementById(wrapperId);
            if(!container.classList.contains('active')) return;
            const activeRow = container.querySelector('.current-month-row');
            if (activeRow) {
                const containerHeight = container.clientHeight;
                const rowTop = activeRow.offsetTop;
                const rowHeight = activeRow.clientHeight;
                container.scrollTop = rowTop - (containerHeight / 2) + (rowHeight / 2);
            }
        }, 50); 
    }

    function renderMainTable() {
        const tbody = document.getElementById('mainTableBody');
        const currentMonthIdx = currentDate.getMonth(); 
        let html = '';
        MONTH_KEYS.forEach((mStr, i) => {
            const d24 = statsDB['2024'][mStr].unique; 
            const d25 = statsDB['2025'][mStr].unique; 
            const diff = d25 - d24;
            const pct = ((diff/d24)*100).toFixed(1);
            const colorClass = diff > 0 ? '#047857' : (diff < 0 ? '#DC2626' : '#64748B');
            const bgClass = (i === currentMonthIdx) ? 'current-month-row' : '';
            html += `<tr class="${bgClass}"><td>${i + 1}ì›”</td><td>${d24.toLocaleString()}</td><td>${d25.toLocaleString()}</td><td style="color:${colorClass}">${diff > 0 ? '+' : ''}${diff.toLocaleString()}</td><td style="color:${colorClass}">${diff > 0 ? '+' : ''}${pct}%</td></tr>`;
        });
        tbody.innerHTML = html;
    }

    function renderTargetTable() {
        const tbody = document.getElementById('targetTableBody');
        const currentMonthIdx = currentDate.getMonth(); 
        let html = '';
        MONTH_KEYS.forEach((mStr, i) => {
            const data = statsDB['2025'][mStr];
            const bgClass = (i === currentMonthIdx) ? 'current-month-row' : '';
            html += `<tr class="${bgClass}"><td>${i + 1}ì›”</td><td>${data.f}%</td><td>${data.age30}%</td><td>${data.age40}%</td></tr>`;
        });
        tbody.innerHTML = html;
    }

    function renderReport() {
        const year = currentDate.getFullYear();
        const monthIndex = currentDate.getMonth(); 
        const monthStr = MONTH_KEYS[monthIndex];
        const nextD = new Date(currentDate);
        nextD.setMonth(nextD.getMonth() + 1);
        const nextMonthStr = String(nextD.getMonth() + 1).padStart(2, '0');

        document.getElementById('currentDate').innerText = `${year}.${monthStr}`;
        document.getElementById('nextMonthLabel').innerText = `${nextMonthStr}ì›”`;

        const cur = statsDB[year][monthStr];
        const prev = statsDB[year-1][monthStr];
        const rank = rankDB[monthStr];
        const score = scoreDB[monthStr];
        const events = getEvents(year, monthStr);
        const recommendationEvents = getEvents(year, nextMonthStr); 

        updateKPI('total', cur.total, prev.total);
        updateKPI('visit', cur.visit, prev.visit); 
        updateKPI('new', cur.new, prev.new);
        document.getElementById('kpi-rank').innerText = rank;
        document.getElementById('kpi-score').innerText = score;

        renderMainChart(statsDB['2024'], statsDB['2025'], monthIndex);
        renderTargetInfographic(cur); // Update CSS Infographic
        renderEventTable(events);
        renderAIInsight(cur, prev, events, recommendationEvents);
    }

    function updateKPI(id, curr, prev) {
        const diff = curr - prev;
        const pct = ((diff/prev)*100).toFixed(1);
        const elVal = document.getElementById(`kpi-${id}`);
        const elDiff = document.getElementById(`diff-${id}`);
        elVal.innerText = curr.toLocaleString();
        const cls = diff > 0 ? 'up' : 'down';
        const icon = diff > 0 ? 'â–²' : 'â–¼';
        elDiff.className = `kpi-diff ${cls}`;
        elDiff.innerHTML = `${icon} ${Math.abs(diff).toLocaleString()} (${pct}%) YoY`;
    }

    function renderMainChart(db24, db25, activeIndex) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(mainChart) mainChart.destroy();
        if(blinkInterval) clearInterval(blinkInterval);

        const data24 = MONTH_KEYS.map(k => db24[k].unique);
        const data25 = MONTH_KEYS.map(k => db25[k].unique);

        const pointRadiuses = new Array(12).fill(3);
        pointRadiuses[activeIndex] = 8; 
        const pointColors = new Array(12).fill('#1E293B');
        pointColors[activeIndex] = '#D97706'; 

        mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length:12}, (_,i)=>`${i+1}ì›”`),
                datasets: [
                    { 
                        label:'2025 ìˆœë°©ë¬¸ (Unique)', 
                        data: data25, 
                        borderColor:'#1E293B', backgroundColor:'rgba(30, 41, 59, 0.1)', borderWidth:2, 
                        pointRadius: pointRadiuses, pointBackgroundColor: pointColors, pointBorderColor: '#fff',
                        fill:true, tension:0.4, order: 1
                    },
                    { 
                        label:'2024 ìˆœë°©ë¬¸ (Unique)', 
                        data: data24, 
                        borderColor:'#94A3B8', borderDash:[5,5], borderWidth:2, pointRadius: 4, 
                        pointHoverRadius: 6, fill:false, tension:0.4, order: 2
                    }
                ]
            },
            options: { 
                responsive:true, maintainAspectRatio:false, 
                interaction: { mode: 'index', intersect: false },
                plugins:{legend:{position:'top', align:'end'}}, 
                scales:{x:{grid:{display:false}}, y:{grid:{color:'#F1F5F9'}}} 
            }
        });

        let isBig = true;
        blinkInterval = setInterval(() => {
            if(!mainChart) return;
            const ds = mainChart.data.datasets[0];
            ds.pointRadius[activeIndex] = isBig ? 4 : 9;
            ds.pointBackgroundColor[activeIndex] = isBig ? '#1E293B' : '#D97706';
            mainChart.update('none'); isBig = !isBig;
        }, 600);
    }

    // --- NEW: Render CSS Infographic ---
    function renderTargetInfographic(data) {
        // Gender
        const f = data.f;
        const m = (100 - f).toFixed(1);
        document.getElementById('val-female').innerText = f + '%';
        document.getElementById('val-male').innerText = m + '%';
        document.getElementById('bar-female').style.width = f + '%';
        document.getElementById('bar-male').style.width = m + '%';

        // Age
        const a30 = data.age30;
        const a40 = data.age40;
        document.getElementById('val-age30').innerText = a30 + '%';
        document.getElementById('bar-age30').style.width = a30 + '%';
        document.getElementById('val-age40').innerText = a40 + '%';
        document.getElementById('bar-age40').style.width = a40 + '%';
    }

    function renderEventTable(events) {
        const tbody = document.getElementById('eventTable');
        if(!events.length) { tbody.innerHTML = '<tr><td colspan="4">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
        const sorted = [...events].sort((a,b) => b.v - a.v);
        tbody.innerHTML = sorted.map((e,i) => `
            <tr>
                <td style="color:#64748B" title="${e.d}">${e.d}</td>
                <td style="font-weight:600; color:#1E293B;" title="${e.t}">${i<3 ? `<span class="rank-circle">${i+1}</span>` : ''} ${e.t}</td>
                <td>${e.v.toLocaleString()}</td>
                <td style="color:#3B82F6; font-weight:600;">${(e.c+e.l).toLocaleString()}</td>
            </tr>
        `).join('');
    }

    function renderAIInsight(cur, prev, currentEvents, nextYearEvents) {
        let analysis = "";
        const curRate = (cur.unique / cur.total * 100).toFixed(1);
        const prevRate = (prev.unique / prev.total * 100).toFixed(1);
        const rateDiff = (curRate - prevRate).toFixed(1);
        
        analysis += `<p>â€¢ <strong>íšŒì› í™œë™ì„±:</strong> ì „ì²´ íšŒì› ëŒ€ë¹„ ìˆœë°©ë¬¸ ë¹„ìœ¨ì´ <span class="ai-highlight">${curRate}%</span>ë¡œ, ì „ë…„ ë™ì›” ëŒ€ë¹„ <span class="ai-highlight">${rateDiff > 0 ? 'â–²' : 'â–¼'}${Math.abs(rateDiff)}%p</span> ${rateDiff > 0 ? 'ìƒìŠ¹' : 'í•˜ë½'}í–ˆìŠµë‹ˆë‹¤.</p>`;

        const pvPerUser = (cur.pv / cur.unique).toFixed(1);
        const pvDiff = ((cur.pv - prev.pv) / prev.pv * 100).toFixed(1);
        analysis += `<p>â€¢ <strong>ê²Œì‹œê¸€ ì†Œë¹„ë ¥:</strong> ì´ ì¡°íšŒìˆ˜(PV)ê°€ ì „ë…„ ëŒ€ë¹„ <span class="ai-highlight">${pvDiff}%</span> ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆœë°©ë¬¸ì 1ì¸ë‹¹ í‰ê·  <span class="ai-highlight">${pvPerUser}ê°œ</span>ì˜ ê¸€ì„ ì½ê³  ìˆìŠµë‹ˆë‹¤.</p>`;

        let totalReaction = 0;
        currentEvents.forEach(e => totalReaction += (e.c + e.l));
        if(totalReaction > 500) {
            analysis += `<p>â€¢ <strong>ì´ë²¤íŠ¸ ì˜í–¥:</strong> ì´ë‹¬ ì§„í–‰ëœ ì´ë²¤íŠ¸ì˜ ë†’ì€ ë°˜ì‘(ì´ ${totalReaction.toLocaleString()}ê±´)ì´ íŠ¸ë˜í”½ ë°©ì–´ì— ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì³¤ìŠµë‹ˆë‹¤.</p>`;
        }

        document.getElementById('ai-analysis').innerHTML = analysis;

        let strategyHTML = "";
        if (nextYearEvents.length > 0) {
            const topEvents = [...nextYearEvents].sort((a,b) => b.v - a.v).slice(0, 3);
            topEvents.forEach((evt, index) => {
                strategyHTML += `
                    <div class="strategy-box">
                        <div class="strategy-rank">#${index+1}</div>
                        <div class="strategy-content">
                            <strong>${evt.t}</strong>
                            <span>ì‘ë…„ ì„±ê³¼: ì¡°íšŒ ${evt.v.toLocaleString()} / ë°˜ì‘ ${(evt.c+evt.l).toLocaleString()}</span>
                        </div>
                    </div>
                `;
            });
        } else {
            strategyHTML = `<div class="strategy-box"><div class="strategy-content"><strong>ë°ì´í„° ë¶€ì¡±</strong><span>í•´ë‹¹ ì›”ì˜ ê³¼ê±° ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span></div></div>`;
        }
        document.getElementById('ai-strategy').innerHTML = strategyHTML;
    }
</script>
</body>
</html>
